# Nginx

[nginx](https://nginx.org/ru/)

> –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é. –ù–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è —Å–µ—Ä–≤–µ—Ä —Å–µ–≥–æ–¥–Ω—è.
> 
- –û—Ç –ò–ª—å–∏ –ö–ª–∏–º–æ–≤–∞
    
    –ø–æ–∫–∞ –ø–∏—à—É –ª–æ–Ω–≥—Ä–∏–¥, —Å–æ–≤–µ—Ç—É—é –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å 12 –º–∏–Ω—É—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [https://vimeo.com/552704650/7cc389e41d](https://vimeo.com/552704650/7cc389e41d)
    
    –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ —É –≤–∞—Å –≤ –∫–æ–Ω—Ñ–∏–≥–µ.¬† —è –≤—ã–∫–∏–Ω—É–ª –ª–∏—à–Ω–µ–µ, –æ—Å—Ç–∞–≤–∏–ª –≤–∞–∂–Ω–æ–µ
    
    server {
    
    root ¬† html;
    
    location / {
    
    proxy_pass http://172.30.19.220:8080;
    
    }
    
    }
    
    root html; <- –æ—Ç–¥–∞–≤–∞—Ç—å –≤—Å–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ html
    
    location / - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–æ—Ä–Ω—è (—Ç.–µ. —Ä–µ–∞–ª—å–Ω–æ –í–°–ï –ó–ê–ü–†–û–°–´) - –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–∑–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç proxy_pass)
    
    –¢.–µ. –º—ã —Ç–∞–∫–∏–µ:
    
    - —Å—Ç—É—á–∏–º—Å—è –∑–∞ —É—Å–ª–æ–≤–Ω–æ–π –≤–∞—à–µ–π html-–∫–æ–π. nginx —á–∏—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞... –ê–≥–∞, –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –Ω–∞ –±–µ–∫–µ–Ω–¥.
    - –ë—ç–∫,. –ø–æ–ª—É—á–∞—é—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ index.html –∏–ª–∏ –Ω–∞ —Ñ–∞–≤–∏–∫–æ–Ω–∫—É - –û–ì–û, —Ö—Ä–µ–Ω–∞—Å–µ, –æ—Ç–¥–∞–µ—Ç –Ω–µ–≤–µ–¥–æ–º—É—é —Ö—Ä–µ–Ω—å
    - nginx –æ—Ç–¥–∞–µ—Ç —ç—Ç—É –Ω–µ–≤–µ–¥–æ–º—É—é —Ö—Ä–µ–Ω—å –≤–∞–º –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å –±—ç–∫–∞
    
    –ß–µ–≥–æ –∂–µ –Ω–∞–¥–æ –Ω–∞–º? –ú—ã —Ö–æ—Ç–∏–º —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ -
    
    "–ø–æ–∏—â–∏ —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ, –∞ –µ—Å–ª–∏ –Ω–µ—Ç - —Ç–æ –Ω–∞–≤–µ—Ä–Ω–æ–µ —ç—Ç–æ –∞–ø–∏ –∑–∞–ø—Ä–æ—Å, –¥–µ—Ä–Ω–∏ –±–µ–∫–µ–Ω–¥"
    
    —ç—Ç–æ –≤ nginx –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–∞—á–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ (–ø–æ—Ç–æ–º—É —á—Ç–æ nginx —Å—Ç–∞—Ä—ã–π), —Å–∞–º—ã–π –ø–æ–Ω—è—Ç–Ω—ã–π - try_files
    
    —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã try_files –≤—ã –º–æ–∂–µ–º —Å–∫–∞–∑–∞—Ç—å nginx –±—É–∫–≤–∞–ª—å–Ω–æ "–ø–æ–ø—Ä–æ–±—É–π —Ç–æ, –ø–æ—Ç–æ–º —Ç–æ"
    
    –í–æ—Ç –Ω–∞–º –º–æ–∂–Ω–æ –≤—ã–∫–∏–Ω—É—Ç—å location / –∏ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ —Å—É–Ω—É—Ç—å —Ç—É–¥–∞ try_files –≥–¥–µ –Ω–∞–ø–∏—Å–∞—Ç—å - –≤–Ω–∞—á–∞–ª–µ –ø–æ–ø—Ä–æ–±—É–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª, –∞ –ø–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤—å –Ω–∞ –±–µ–∫
    
    –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ
    
    - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å try_files
    - —É–∑–Ω–∞—Ç—å –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å "–ø—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ" (–ø–æ–¥—Å–∫–∞–∑–∫–∞ - –æ–Ω –±—É–¥–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –¥–æ–ª–ª–∞—Ä–∞)
    - —É–∑–Ω–∞—Ç—å –∫–∞–∫ –æ–±—ä—è–≤–∏—Ç—å "–æ—Ç–ø—Ä–∞–≤—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä" - –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –±—É–¥–µ—Ç –æ–±—ä—è–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π upstream –∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —ç—Ç–æ–º—É upstream —á–µ—Ä–µ–∑ —Å–æ–±–∞–∫—É –≤ try_files
    
    –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –∫–æ–Ω–µ—á–Ω–æ –∂–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–Ω–∞—á–∞–ª–µ —É –Ω–∞—Å –±–µ–∑ –≤—Å—è–∫–∏—Ö try_files –æ—Ç–¥–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏–∫–∞, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å try_files —Å –æ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º, –∏ –ø–æ—Ç–æ–º –ø—Ä–∏–∫—Ä—É—á–∏–≤–∞—Ç—å –∞–ø–∏. –ê —Ç–æ –µ—Å–ª–∏ –ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ñ–∏–≥ —Å—Ä–∞–∑—É —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç )
    

```jsx
nginx
nginx -s reload
nginx -s stop
```

### Mac OS

```jsx
Docroot is: /usr/local/var/www

The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that
nginx can run without sudo.

nginx will load all files in /usr/local/etc/nginx/servers/.

To restart nginx after an upgrade:
  brew services restart nginx
Or, if you don't want/need a background service you can just run:
  /usr/local/opt/nginx/bin/nginx -g daemon off;
==> Summary
üç∫  /usr/local/Cellar/nginx/1.23.4: 26 files, 2.2MB
```

```jsx
usr/local/etc/nginx - —Ç—É—Ç –∫–æ–Ω—Ñ–∏–≥–∏
usr/local/Cellar/nginx - —Ç—É—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ nginx (—Å–∞–º–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞)

–µ—â—ë –≤ Downloads —Å–∞–º –ø–∞–∫–µ—Ç nginx —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ (—Å–∫–∞—á–∞–ª —Å –æ—Ñ —Å–∞–π—Ç–∞)
```

### –§–∞–π–ª—ã web —Å–µ—Ä–≤–µ—Ä–∞

- –ö–æ–Ω—Ñ–∏–≥ `etc/nginx/nginx.conf`
    
    `include /etc/nginx/sites-enabled/*` (–≤–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –≤ –¥—Ä—É–≥–æ–π - –∏–º–ø–æ—Ä—Ç—ã)
    
- Init-—Å–∫—Ä–∏–ø—Ç `etc/init.d/nginx [start|stop|restart]`
- PID-—Ñ–∞–π–ª - —Ñ–∞–π–ª —Å PID –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (—Ç–∞–∫ –∫–∞–∫ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–µ–º–æ–Ω –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç –∫–æ–Ω—Å–æ–ª–∏) `/var/run/nginx.pid`
- Error-log (—Ñ–æ—Ä–º–∞—Ç - —Å–≤–æ–±–æ–¥–Ω—ã–π) `/var/log/nginx/error.log`
- Access-log (—É—Å–ø–µ—à–Ω–æ/–Ω–µ—É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã) - —Ñ–∞–π–ª –∏–º–µ–µ—Ç –∂–µ—Å—Ç–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –∏ –º–æ–∂–µ—Ç –ø–∞—Ä—Å–∏—Ç—å—Å—è `/var/log/nginx/access.log`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è web —Å–µ—Ä–≤–µ—Ä–∞ - virtual host, location

–§—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥–∞

- **virtual host** - —Å–µ–∫—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω, –¥–æ–º–µ–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –æ—Ç–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏‚Ä¶ Shared hosting - –Ω–∞ –æ–¥–Ω–æ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–∑–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–∞–π—Ç—ã.
- **location** - —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π URL –Ω–µ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ - —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–¥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç - –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ **–≥—Ä—É–ø–ø–∞ URL‚Äô–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä** (–∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç)

```jsx
// –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≥—Ä—É–ø–ø—ã, –æ—Ç –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä
user www www;
// —Ñ–∞–π–ª –¥–ª—è –æ—à–∏–±–æ–∫ –∏ —É—Ä–æ–≤–µ–Ω—å —ç—Ç–∏—Ö –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä. info –∏ –≤—ã—à–µ)
error_log /var/log/nginx.error_log info;
// —Ç–∞–∫ –∫–∞–∫ nginx –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º (–Ω–∞–ø—Ä. –ø—Ä–æ–∫—Å–∏), —Ç—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
// —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–æ–ª–∏ http —Å–µ—Ä–≤–µ—Ä–∞
http {
	// –≤ —Ñ–∞–π–ª–µ - –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ mime —Ç–∏–ø–∞–≤ —Ñ–∞–π–ª–æ–≤
  // –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ content type
	include      conf/mime.types;
	// –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–∏–ø –æ—Ç–¥–∞–≤–∞–µ–º–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
	default_type application/octet-stream;
	// —Ñ–æ—Ä–º–∞—Ç access –ª–æ–≥–∞ - IP URL –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
	log_format   simple `$remote_addr $request $status`;
	// –æ–ø–∏—Å–∞–Ω–∏–µ virtual host'a
	server {
		// –Ω–∞ –∫–∞–∫–æ–º IP –∏ –ø–æ—Ä—Ç—É –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª —Ö–æ—Å—Ç
		listen      one.example.com;
		// –∫–∞–∫–∏–º –¥–æ–º–µ–Ω–∞–º –¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç
		server_name one.example.com www.one.example.com;
    // —á–µ–º –Ω–∏–∂–µ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ access log, —Ç–µ–º –≤—ã—à–µ –µ—ë –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
		access_log  /var/log/nginx.access_log simple;
		// –≥—Ä—É–ø–ø–∞ —É—Ä–ª–æ–≤ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–º. –¥–∞–ª–µ–µ
		location / {
			root         /www/one.example.com;
		}
		location ~* ^.+\.(jpg|jpeg|gif)$ {
			root         /www/images;
			access_log   off;
			expires      30d;
		}
	}
}
```

- `http` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ http —Å–µ—Ä–≤–µ—Ä–∞
- `server` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞ (–≤–∏—Ä—Ç—É–∞–ª —Ö–æ—Å—Ç–∞)
- `server_name` - –∏–º–µ–Ω–∞ –¥–æ–º–µ–Ω–æ–≤
- `location` - –≥—Ä—É–ø–ø–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–µ–º—ã—Ö URL‚Äô–æ–≤
- `root`, `alias` - –æ—Ç–∫—É–¥–∞ –Ω—É–∂–Ω–æ –±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
    
    <aside>
    üëâüèº `alias` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å location, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞–Ω –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É, –∞ –Ω–µ –≤ –≤–∏–¥–µ —Ä–µ–≥—É–ª—è—Ä–∫–∏
    
    </aside>
    
- `error_log` - —Ñ–∞–π–ª –ª–æ–≥–∞ —Å –æ—à–∏–±–∫–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
- `access_log` - —Ñ–∞–π–ª –ª–æ–≥–∞ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç location –≤ nginx (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É)

- `location = /img/1.jpg` - —Å–∏–º–≤–æ–ª = –æ–∑–Ω–∞—á–∞–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- `location ^~ /pic/` - —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ, —á–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
- `location ~* \.jpg$` - —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é
- `location /img/` - —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –≤ —É—Ä–ª–µ (–µ—Å–ª–∏ —É—Ä–ª –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–µ–≥–æ)

–ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç location, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—ã—à–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

### –û—Ç–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

```jsx
location ~* ^.+\.(jpg|jpeg|gif|png)$ {
	root    /www/imgaes; - –∏–∑ –∫–∞–∫–æ–π –ø–∞–ø–∫–∏ –±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
}
location /sitemap/ {
	alias   /home/www/generated;
}
```

`/2015/10/ae2b4.jpg` ‚Üí `/www/images/2015/10/ae2b4.jpg`

`/sitemap/index.xml` ‚Üí `/home/www/generated/index.xml`

- ***–ü—Ä–∏–º–µ—Ä —Ä–∞–∑–Ω—ã—Ö location***
    
    ```jsx
    # —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É - –Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (4)
    location /static {
        # –∑–∞–º–µ–Ω–∞ –ø—É—Ç–∏ .../static –Ω–∞ —ç—Ç–æ—Ç
        alias    /Users/Phil/Documents/Projects/nginx/public;
    }
    
    location /public-empty {
        root    /Users/Phil/Documents/Projects/nginx;
        # –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π –Ω–∞–π—Ç–∏ –∏ –æ—Ç–¥–∞—Ç—å —ç—Ç–∏
        try_files /index.html =404;
    }
    
    # —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ - –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1)
    location = /main-pic {
        alias    /Users/Phil/Documents/Projects/nginx/public/images/1.jpg;
    }
    
    # —Ä–µ–≥—É–ª—è—Ä–∫–∞ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (3)
    location ~* ^.+[1-7]\.(jpg|jpeg|png)$ {
        root    /Users/Phil/Documents/Projects/nginx/public/images;
    }
    
    # –ø—Ä–µ—Ñ–∏–∫—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ —Ä–µ–≥—É–ª—è—Ä–∫–∏ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (2)
    location ^~ /pic {
        root    /Users/Phil/Documents/Projects/nginx/public;
    }
    
    location /static-old {
        # redirect - –ø—Ä–∏ —ç—Ç–æ–º URL –∑–∞–º–µ–Ω—è–µ—Ç—Å—è
        return 307 /static;
    }
    
    location /static-new {
        # redirect - –ø—Ä–∏ —ç—Ç–æ–º URL –æ—Å—Ç–∞–µ—Ç—Å—è
        rewrite ^ /index.html break;
    }
    
    location /api {
        proxy_pass https://github.com/;
    }
    ```
    

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

Nginx –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞. –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—à–ª–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –∞ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø—Ä–∏—à–µ–¥—à–∏–µ –æ—Ç –±—ç–∫–µ–Ω–¥–∞.

–¢–∞–∫–∂–µ —á–∞—Å—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `Host` –∏ `X-Real-IP`. 

- –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å Host, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –Ω–∞ nginx, —Ç–æ –æ–Ω –ø—Ä–∏–¥–µ—Ç –∏ –±—ç–∫ —Å–µ—Ä–≤–µ—Ä—É, —Ö–æ—Ç—è –æ–Ω –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ –∏ –æ–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å (–ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Ö–æ—Å—Ç –Ω–µ –±—É–¥–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ö–æ—Å—Ç–æ–º –±—ç–∫ —Å–µ—Ä–≤–µ—Ä–∞)
- –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ nginx –µ–º—É –∏–∑–≤–µ—Å—Ç–µ–Ω IP –∫–ª–∏–µ–Ω—Ç–∞. –ß—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –±—ç–∫ —Å–µ—Ä–≤–µ—Ä—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ X-Real-IP (–∞ –Ω–µ IP nginx‚Äôa)

```jsx
// config fragment

// –ø–æ–¥–º–µ–Ω—è–µ–º —Ö–æ—Å—Ç (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
proxy_set_header Host      $host; // –∏–ª–∏ $proxy_host 
proxy_set_header X-Real-IP $remote_addr;

location / {
	// –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL
	// –≥–¥–µ backend - –∏–º—è upstream'a
	proxy_pass http://backend;
}

location /partner/ {
	// –Ω–∞—Å—Ç–æ—è—â–∏–π URL
	// –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Ç–∏–ø–∞ /partner/doc/1,
	// —Ç–æ –∏—Ç–æ–≥–æ–≤—ã–π URL - http://www.partner.com/doc/1
	proxy_pass http://www.partner.com;
}

// —Ä–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ - –µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
location ~ \.\w\w\w?\w?$ {
	// –æ—Ç–¥–∞—á–∞ —Å –¥–∏—Å–∫–∞ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ www/static
	root /www/static;
}
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ upstream‚Äô–æ–≤

Upstream - —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–æ–¥ –æ–±—â–µ–º –∏–º–µ–Ω–µ–º (–∞–ª–∏–∞—Å).

- weight - –≤–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—Ç –º–æ—â–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –±–æ–ª—å—à–µ)
- max_fails - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–æ–ª–∂–µ–Ω –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –µ–≥–æ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ù—É–∂–Ω–æ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.
- –ø–æ–º–∏–º–æ IP –∞–¥—Ä–µ—Å–æ–≤ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å unix —Å–æ–∫–µ—Ç—ã
- backup - –æ–ø—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π, –∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ –Ω–µ –º–æ–≥—É—Ç –æ–±—Å–ª—É–∂–∏—Ç—å –∑–∞–ø—Ä–æ—Å

```jsx
upstream backend {
	server back1.example.com:8080 weight=1 max_fails=3;
	server back2.example.com:8080 weight=2;
	server unix:/tmp/backend.sock;
	server backup1.example.com:8080 backup;
}
```

### Avoiding top 10 nginx configuration mistakes

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—å–∏ [Avoiding the Top 10 NGINX Configuration Mistakes](https://www.nginx.com/blog/avoiding-top-10-nginx-configuration-mistakes/)

1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ worker –ø—Ä–æ—Ü–µ—Å—Å–∞
    
    –ï–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ [`worker_connnections`](https://nginx.org/en/docs/ngx_core_module.html#worker_connections) (–ø–æ –¥–µ—Ñ–æ–ª—Ç—É —Ä–∞–≤–Ω–æ 512)
    
    –í–∞–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å - –≤ —ç—Ç–æ —á–∏—Å–ª–æ –≤—Ö–æ–¥–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –Ω–æ —Ç–∞–∫–∂–µ –∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏, –µ—Å–ª–∏ nginx –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –ø—Ä–æ–∫—Å–∏
    
2. 

[–î–æ–º–∞—à–∫–∞ –ø–æ Nginx](Nginx%20cf303b2df0fa4ada8b7eca302461ffe7/%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BA%D0%B0%20%D0%BF%D0%BE%20Nginx%200ee39c3204e84ea4bfd2b07fe108cd2b.md)